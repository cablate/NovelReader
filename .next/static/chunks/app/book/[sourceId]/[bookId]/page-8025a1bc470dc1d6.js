(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{31127:function(e,t,n){Promise.resolve().then(n.bind(n,34133))},34133:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var a=n(57437),c=n(12730),r=n(4293),o=n(6882),l=n(49050),s=n(38947),u=n(466),i=n(24033),d=n(2265);function f(e){let{params:t}=e,n=(0,i.useRouter)(),f=t.sourceId,m=t.bookId,p=(0,i.useSearchParams)(),x=p.get("page"),g=(0,d.useRef)(null),[h,b]=(0,d.useState)(void 0),[v,N]=(0,d.useState)(x?Number(x):1),[k,y]=(0,d.useState)(!0),{data:j,isLoading:w}=(0,s.a)(["book",f,m,v],e=>{let{signal:t}=e;return c.h.get("book?sourceid=".concat(f,"&bookid=").concat(m,"&page=").concat(v),{signal:t}).then(e=>e.data).then(e=>e.data)});(0,d.useEffect)(()=>{j&&(b(j),(0,r.u)(j.name))},[j,v]),(0,d.useEffect)(()=>{if(h){if(k&&g.current){let e=localStorage.getItem("recent"),t=e?JSON.parse(e):{},n=t["".concat(f,"-").concat(m)];if(n){let e=g.current.scrollHeight,t=g.current.clientHeight,a=(e-t)*(n.percentage/100);g.current.scrollTop=a,y(!1)}else y(!1)}!k&&g.current&&(g.current.scrollTop=0)}},[h]);let{data:S}=(0,s.a)(["book",f,m,v+1],e=>{let{signal:t}=e;return c.h.get("book?sourceid=".concat(f,"&bookid=").concat(m,"&page=").concat(v+1),{signal:t}).then(e=>e.data).then(e=>e.data)});return(0,d.useEffect)(()=>{var e;let t=()=>{if(!g.current)return;let e=g.current.scrollHeight,t=g.current.scrollTop,n=g.current.clientHeight,a=localStorage.getItem("recent"),c=a?JSON.parse(a):{};e-t===n?c["".concat(f,"-").concat(m)]={page:v,name:null==h?void 0:h.name,date:(0,u.Z)(new Date,"yyyy-MM-dd HH:mm:ss"),percentage:100}:c["".concat(f,"-").concat(m)]={page:v,name:null==h?void 0:h.name,date:(0,u.Z)(new Date,"yyyy-MM-dd HH:mm:ss"),percentage:(t/(e-n)*100).toFixed(2)},localStorage.setItem("recent",JSON.stringify(c))};return null===(e=g.current)||void 0===e||e.addEventListener("scroll",t),()=>{var e;null===(e=g.current)||void 0===e||e.removeEventListener("scroll",t)}},[h,v,f,m]),(0,a.jsxs)("div",{className:"w-full flex flex-col justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1 w-full overflow-auto",ref:g,children:[w&&(0,a.jsx)(o.Z,{className:"m-auto"}),!w&&!h&&(0,a.jsx)("div",{className:"m-auto text-gray-500",children:"目前沒有資料"}),!w&&h&&(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:h.context},className:"p-[16px] text-[23px]"})]}),(0,a.jsxs)("div",{className:"border border-t-black flex flex-col justify-center align-middle p-[8px]",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between mb-[6px]",children:[(0,a.jsx)(l.Z,{variant:"outlined",className:"!bg-[#3f51b5] !text-[#FFF] !p-[2px]  !rounded-md",onClick:()=>{N(e=>e-1),n.push("/book/".concat(f,"/").concat(m,"?page=").concat(v-1))},children:"上一頁"}),(0,a.jsx)(l.Z,{variant:"outlined",className:"!bg-[#3f51b5] !text-[#FFF] !p-[2px]  !rounded-md",onClick:()=>{n.push("/search/".concat(f))},children:"回到列表"})]}),(0,a.jsx)(l.Z,{variant:"contained",className:"!bg-[#3f51b5] !text-[#FFF] !p-[6px]  !rounded-md",children:"下一頁"})]})]})}},12730:function(e,t,n){"use strict";n.d(t,{h:function(){return c}});var a=n(29222);let c=a.Z.create({baseURL:"http://192.168.69.159:3000/api",timeout:3e3})},4293:function(e,t,n){"use strict";n.d(t,{u:function(){return a}}),n(46323);let a=e=>{let t=new CustomEvent("PageNameUpdate",{detail:{name:e}});document.dispatchEvent(t)}}},function(e){e.O(0,[719,714,529,282,50,474,971,596,744],function(){return e(e.s=31127)}),_N_E=e.O()}]);